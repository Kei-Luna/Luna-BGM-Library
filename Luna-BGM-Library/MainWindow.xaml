<Window x:Class="LunaBgmLibrary.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:LunaBgmLibrary.Controls"
        Title="Luna-BGM-Library" Height="640" Width="980"
        WindowStartupLocation="CenterScreen"
        Background="#111111" Foreground="#FFFFFF">
    <Grid Margin="16">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="3*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <DockPanel Grid.ColumnSpan="2" Grid.Row="0" LastChildFill="False" Margin="0 0 0 12">
            <TextBlock Text="Luna-BGM-Library" FontSize="22" FontWeight="Bold" VerticalAlignment="Center"/>
            <StackPanel Orientation="Horizontal" Margin="16,0,0,0" VerticalAlignment="Center">
                <TextBlock Text="Folder:" Margin="0,0,6,0" VerticalAlignment="Center"/>
                <ComboBox x:Name="FolderPicker"
                          SelectionChanged="FolderPicker_SelectionChanged"
                          Margin="5"
                          Background="Black"
                          Foreground="{Binding RelativeSource={RelativeSource Self}, Path=SelectedItem, Converter={StaticResource AllFoldersForegroundConverter}}"/>
            </StackPanel>

                <Button x:Name="SettingsButton"
                        Content="⚙"
                        Width="28" Height="28"
                        DockPanel.Dock="Right"
                        Margin="0,0,0,0"
                        Background="Transparent"
                        Foreground="White"
                        BorderThickness="0"
                        ToolTip="Equalizer"
                        Click="SettingsButton_Click"/>
        </DockPanel>

        <Border Grid.Row="1" Grid.Column="0" Margin="0 0 12 0" Padding="8"
                Background="#141414" BorderBrush="#2A2A2A" BorderThickness="1">
            <ScrollViewer>
                <ItemsControl x:Name="PlaylistView">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Margin="0 6" Padding="10"
                                    Background="#1A1A1A" BorderBrush="#2A2A2A" BorderThickness="1" CornerRadius="8">
                                <Grid MouseLeftButtonDown="TrackItem_MouseLeftButtonDown">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="56"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="70"/>
                                    </Grid.ColumnDefinitions>
                                    <Image Grid.Column="0" Width="48" Height="48" Stretch="UniformToFill"
                                           Source="{Binding Artwork}">
                                        <Image.Style>
                                            <Style TargetType="Image">
                                                <Setter Property="Visibility" Value="Visible"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Artwork}" Value="{x:Null}">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Image.Style>
                                    </Image>
                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="{Binding Title}" FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding Artist}" Opacity="0.8" FontSize="12"/>
                                    </StackPanel>
                                    <TextBlock Grid.Column="2" HorizontalAlignment="Right" VerticalAlignment="Center"
                                               Text="{Binding Duration, StringFormat={}{0:mm\\:ss}}" Opacity="0.9"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>

        <Border Grid.Row="1" Grid.Column="1" Padding="16"
                Background="#141414" BorderBrush="#2A2A2A" BorderThickness="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="120"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0 0 0 8">
                    <Image x:Name="NowArt" Width="90" Height="90" Margin="0 0 16 0" Stretch="UniformToFill"/>
                    <StackPanel>
                        <TextBlock x:Name="NowTitle" FontSize="20" FontWeight="Bold"/>
                        <TextBlock x:Name="NowArtist" Opacity="0.9"/>
                        <TextBlock x:Name="NowAlbum"  Opacity="0.8"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel Grid.Row="1" Margin="0 12 0 0">
                    <Slider x:Name="SeekBar" Minimum="0" Maximum="100"
                            Background="#1E1E1E" Foreground="#FFFFFF"
                            ValueChanged="SeekBar_ValueChanged" PreviewMouseLeftButtonUp="SeekBar_MouseUp" />
                    <DockPanel>
                        <TextBlock x:Name="ElapsedText" Text="00:00"/>
                        <TextBlock x:Name="TotalText" Text="00:00" HorizontalAlignment="Right" DockPanel.Dock="Right"/>
                    </DockPanel>
                </StackPanel>

                <Border Grid.Row="2" Margin="0 16 0 0" Padding="8"
                        Background="#0A0A0A" BorderBrush="#2A2A2A" BorderThickness="1" CornerRadius="4">
                    <controls:SpectrumDisplay x:Name="SpectrumDisplay"
                                              BarColor="#0096FF" 
                                              BackgroundColor="Transparent"
                                              BarCount="128"/>
                </Border>

                <StackPanel Grid.Row="3" Margin="0 32 0 0">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" >
                        <ToggleButton x:Name="ShuffleToggle" Content="Shuffle" Margin="0 0 6 0"
                                      Background="#1E1E1E" Foreground="#FFFFFF" BorderBrush="#333333"/>
                        <ToggleButton x:Name="RepeatToggle" Content="Repeat" Margin="6 0 0 0"
                                      Background="#1E1E1E" Foreground="#FFFFFF" BorderBrush="#333333"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0 16 0 0">
                        <Button Content="⏮" Width="56" Height="40" Margin="4" Click="Prev_Click"
                                Background="#1E1E1E" Foreground="#FFFFFF" BorderBrush="#333333"/>
                        <Button x:Name="PlayPauseBtn" Content="▶" Width="72" Height="44" Margin="8" Click="PlayPause_Click"
                                Background="#1E1E1E" Foreground="#FFFFFF" BorderBrush="#333333"/>
                        <Button Content="⏭" Width="56" Height="40" Margin="4" Click="Next_Click"
                                Background="#1E1E1E" Foreground="#FFFFFF" BorderBrush="#333333"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0 12 0 0">
                        <TextBlock Text="Vol" VerticalAlignment="Center" Margin="0 0 8 0"/>
                        <Slider x:Name="VolumeSlider" Width="240" Minimum="0" Maximum="1" Value="0.5"
                                Background="#1E1E1E" Foreground="#FFFFFF"
                                ValueChanged="VolumeSlider_ValueChanged"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

        <DockPanel Grid.Row="2" Grid.ColumnSpan="2" Margin="0 12 0 0">
            <TextBlock Text="{Binding ElementName=StatusText, Path=Text}" Opacity="0.7"/>
            <TextBlock x:Name="StatusText" Text="Ready" Visibility="Collapsed"/>
        </DockPanel>
    </Grid>
</Window>
