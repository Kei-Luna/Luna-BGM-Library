<Window x:Class="LunaBgmLibrary.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:LunaBgmLibrary.Controls"
        Title="Luna-BGM-Library" Height="880" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource DarkBackgroundBrush}" 
        Foreground="{StaticResource TextPrimaryBrush}"
        AllowsTransparency="False"
        WindowStyle="SingleBorderWindow">
    <Grid Margin="16">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="3*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <DockPanel Grid.ColumnSpan="2" Grid.Row="0" LastChildFill="False" Margin="0 0 0 12">
            <TextBlock Text="Luna BGM Library" FontSize="24" FontWeight="Bold" VerticalAlignment="Center" Foreground="{StaticResource TextPrimaryBrush}"/>
            <StackPanel Orientation="Horizontal" Margin="16,0,0,0" VerticalAlignment="Center">
                <TextBlock Text="Folder:" Margin="0,0,6,0" VerticalAlignment="Center"/>
                <ComboBox x:Name="FolderPicker"
                          SelectionChanged="FolderPicker_SelectionChanged"
                          Margin="8"
                          Style="{StaticResource ModernComboBoxStyle}"/>
            </StackPanel>

                <Button x:Name="SettingsButton"
                        Content="âš™ï¸"
                        Width="40" Height="40"
                        DockPanel.Dock="Right"
                        Margin="8,4,8,4"
                        VerticalAlignment="Center"
                        Style="{StaticResource ModernButtonStyle}"
                        ToolTip="Equalizer"
                        Click="SettingsButton_Click">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="border"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="8">
                                <Image Source="Asset/Equalizer.png"
                                       Stretch="Uniform"
                                       HorizontalAlignment="Stretch"
                                       VerticalAlignment="Stretch"
                                       Margin="0"
                                       SnapsToDevicePixels="True"
                                       RenderOptions.BitmapScalingMode="HighQuality"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryGradient}"/>
                                    <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource AccentBlueBrush}"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="border" Property="Background">
                                        <Setter.Value>
                                            <SolidColorBrush Color="{StaticResource SecondaryBlue}"/>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
                <Button x:Name="DownloadButton"
                        Content="â¬‡ï¸"
                        Width="40" Height="40"
                        DockPanel.Dock="Right"
                        Margin="8,4,8,4"
                        VerticalAlignment="Center"
                        Style="{StaticResource ModernButtonStyle}"
                        ToolTip="Download BGM Files"
                        Click="DownloadButton_Click">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="border"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="8">
                                <Image Source="Asset/Download.png"
                                       Stretch="Uniform"
                                       HorizontalAlignment="Stretch"
                                       VerticalAlignment="Stretch"
                                       Margin="0"
                                       SnapsToDevicePixels="True"
                                       RenderOptions.BitmapScalingMode="HighQuality"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryGradient}"/>
                                    <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource AccentBlueBrush}"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="border" Property="Background">
                                        <Setter.Value>
                                            <SolidColorBrush Color="{StaticResource SecondaryBlue}"/>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
                <Button x:Name="UnpackButton"
                        Content="ðŸ“¦"
                        Width="40" Height="40"
                        DockPanel.Dock="Right"
                        Margin="8,4,8,4"
                        VerticalAlignment="Center"
                        Style="{StaticResource ModernButtonStyle}"
                        ToolTip="Unpack PCK Files"
                        Click="UnpackButton_Click">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="border"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="8">
                                <Image Source="Asset/Unpack.png"
                                       Stretch="Uniform"
                                       HorizontalAlignment="Stretch"
                                       VerticalAlignment="Stretch"
                                       Margin="0"
                                       SnapsToDevicePixels="True"
                                       RenderOptions.BitmapScalingMode="HighQuality"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryGradient}"/>
                                    <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource AccentBlueBrush}"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="border" Property="Background">
                                        <Setter.Value>
                                            <SolidColorBrush Color="{StaticResource SecondaryBlue}"/>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
        </DockPanel>

        <Border Grid.Row="1" Grid.Column="0" Margin="0 0 12 0" Padding="12"
                Style="{StaticResource ModernCardStyle}">
            <ScrollViewer>
                <ItemsControl x:Name="PlaylistView">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Margin="0 8" Padding="12"
                                    Style="{StaticResource TrackItemStyle}">
                                <Grid MouseLeftButtonDown="TrackItem_MouseLeftButtonDown">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="56"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="70"/>
                                    </Grid.ColumnDefinitions>
                                    <Border Grid.Column="0" Width="52" Height="52" CornerRadius="6">
                                        <Image Stretch="UniformToFill" Source="{Binding Artwork}">
                                            <Image.Style>
                                                <Style TargetType="Image">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Artwork}" Value="{x:Null}">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Image.Style>
                                        </Image>
                                    </Border>
                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="{Binding Title}" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}" FontSize="14"/>
                                        <TextBlock Text="{Binding Artist}" Foreground="{StaticResource TextSecondaryBrush}" FontSize="12"/>
                                    </StackPanel>
                                    <TextBlock Grid.Column="2" HorizontalAlignment="Right" VerticalAlignment="Center"
                                               Text="{Binding Duration, StringFormat={}{0:mm\\:ss}}" Foreground="{StaticResource TextSecondaryBrush}" FontWeight="Medium"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>

        <Border Grid.Row="1" Grid.Column="1" Padding="20"
                Style="{StaticResource ModernCardStyle}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="220"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0 0 0 8">
                    <Border Width="100" Height="100" Margin="0 0 20 0" CornerRadius="12">
                        <Image x:Name="NowArt" Stretch="UniformToFill"/>
                    </Border>
                    <StackPanel>
                        <TextBlock x:Name="NowTitle" FontSize="22" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                        <TextBlock x:Name="NowArtist" FontSize="16" Foreground="{StaticResource TextSecondaryBrush}"/>
                        <TextBlock x:Name="NowAlbum" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel Grid.Row="1" Margin="0 12 0 0">
                    <Slider x:Name="SeekBar" Minimum="0" Maximum="100"
                            Style="{StaticResource ModernSliderStyle}"
                            ValueChanged="SeekBar_ValueChanged" 
                            PreviewMouseLeftButtonDown="SeekBar_MouseDown"
                            PreviewMouseLeftButtonUp="SeekBar_MouseUp" />
                    <DockPanel Margin="0,4,0,0">
                        <TextBlock x:Name="ElapsedText" Text="00:00" Foreground="{StaticResource TextPrimaryBrush}" FontWeight="Medium"/>
                        <TextBlock x:Name="TotalText" Text="00:00" HorizontalAlignment="Right" DockPanel.Dock="Right" Foreground="{StaticResource TextSecondaryBrush}" FontWeight="Medium"/>
                    </DockPanel>
                </StackPanel>

                <Border Grid.Row="2" Margin="0 20 0 0" Padding="12"
                        Background="{StaticResource DarkBackgroundBrush}" 
                        BorderBrush="{StaticResource BorderBrush}" 
                        BorderThickness="1" 
                        CornerRadius="8"
                        Effect="{x:Null}">
                    <controls:SpectrumDisplay x:Name="SpectrumDisplay"
                                              BarColor="#0096FF" 
                                              BackgroundColor="Transparent"
                                              BarCount="32"
                                              StartColor="#00E5FF"
                                              EndColor="#FF4BCD"
                                              PeakExponent="1.6"
                                              VerticalScale="3.5"
                                              LobeWidthFactor="2.2"/>
                </Border>

                <StackPanel Grid.Row="3" Margin="0 32 0 0">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" >
                        <ToggleButton x:Name="ShuffleToggle" Content="ðŸ”€ Shuffle" Margin="0 0 8 0"
                                      Style="{StaticResource ModernToggleButtonStyle}"/>
                        <ToggleButton x:Name="RepeatToggle" Content="ðŸ” Repeat" Margin="8 0 0 0"
                                      Style="{StaticResource ModernToggleButtonStyle}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0 16 0 0">
                        <Button Content="â®" Width="60" Height="44" Margin="6" Click="Prev_Click"
                                Style="{StaticResource ModernButtonStyle}"/>
                        <Button x:Name="PlayPauseBtn" Content="â–¶" Width="80" Height="50" Margin="10" Click="PlayPause_Click"
                                Style="{StaticResource ModernButtonStyle}" FontSize="18"/>
                        <Button Content="â­" Width="60" Height="44" Margin="6" Click="Next_Click"
                                Style="{StaticResource ModernButtonStyle}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0 12 0 0">
                        <TextBlock Text="ðŸ”Š Volume" VerticalAlignment="Center" Margin="0 0 12 0" Foreground="{StaticResource TextPrimaryBrush}" FontWeight="Medium"/>
                        <Slider x:Name="VolumeSlider" Width="260" Minimum="0" Maximum="1" Value="0.5"
                                Style="{StaticResource ModernSliderStyle}"
                                ValueChanged="VolumeSlider_ValueChanged"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

        <DockPanel Grid.Row="2" Grid.ColumnSpan="2" Margin="0 12 0 0">
            <TextBlock Text="{Binding ElementName=StatusText, Path=Text}" Opacity="0.7"/>
            <TextBlock x:Name="VersionLabel"
                       DockPanel.Dock="Right"
                       HorizontalAlignment="Right"
                       Foreground="{StaticResource TextSecondaryBrush}"
                       Opacity="0.7"
                       Text="v_0.0"/>
            <TextBlock x:Name="StatusText" Text="Ready" Visibility="Collapsed"/>
        </DockPanel>
    </Grid>
</Window>
 
